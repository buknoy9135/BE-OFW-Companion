<!-- Main Content -->
<div class="flex-1 p-6 md:p-10 mb-6 lg:ml-64 min-h-dvh space-y-6 bg-gray-50">

  <!-- Header -->
  <div>
    <% if @packages.present? %>
      <div class="flex items-center justify-between mb-4 h-16">
        <h1 class="text-2xl font-semibold">My Packages</h1>
        <%= link_to "✚ Track New Package", new_package_path,
              class: "bg-blue-600 text-white px-3 py-2 rounded hover:bg-blue-700 text-sm sm:text-base" %>
      </div>
    <% else %>
      <!-- Nothing here, header is empty when no packages -->
    <% end %>
  </div>

  <!-- body -->
  <% if @packages.present? %>
    <div class="overflow-x-auto rounded-lg border border-gray-200">      
      <table class="w-full text-sm md:text-xs lg:text-sm">
        <thead class="bg-gray-100">
          <tr>
            <!-- Tracking: always visible -->
            <th class="px-4 py-2 text-center font-medium text-gray-900">Tracking</th>
            
            <!-- Courier: visible on tablet and larger -->
            <th class="px-4 py-2 text-center font-medium text-gray-900 hidden md:table-cell">Courier</th>
            
            <!-- Status: always visible -->
            <th class="px-4 py-2 text-center font-medium text-gray-900">Status</th>

            <!-- Courier: visible on tablet and larger -->
            <th class="px-4 py-2 text-center font-medium text-gray-900 hidden md:table-cell">Description</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <% @packages.each do |pkg| %>
            <% latest_event = pkg.latest_event_raw || {} %>
            <% description = latest_event["description"] || "Not Specified" %>
            <% current_status =
                  latest_event["stage"].presence ||
                  latest_event["sub_status"].to_s.split("_").first.presence ||
                  pkg.status.presence || "Unknown" %>
            <% current_status = current_status.gsub(/([a-z])([A-Z])/, '\1 \2').titleize %>

            <tr class="hover:bg-gray-50 cursor-pointer" onclick="window.location='<%= package_path(pkg) %>'">
              <td class="px-4 py-3 font-medium text-gray-900 text-center text-xs sm:text-sm"><%= pkg.tracking_number %></td>
              <td class="px-4 py-3 text-gray-900 text-center text-xs sm:text-sm hidden md:table-cell"><%= pkg.courier_name %></td>
              <td class="px-4 py-3 text-gray-900 text-center text-xs sm:text-sm"><%= current_status %></td>
              <td class="px-4 py-3 text-gray-900 text-center text-xs sm:text-sm hidden md:table-cell"><%= truncate(description, length: 50, omission: "...") %></td>
            </tr>
          <% end %>
        </tbody>
      </table>   
    </div>
  <% else %>
    <div class="flex flex-col gap-3 items-center justify-center content_center min-h-dvh">
      <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-package-plus-icon lucide-package-plus"><path d="M16 16h6"/><path d="M19 13v6"/><path d="M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14"/><path d="m7.5 4.27 9 5.15"/><polyline points="3.29 7 12 12 20.71 7"/><line x1="12" x2="12" y1="22" y2="12"/></svg>
      <p class="text-gray-600 py-2 text-center sm:text-left">
        You haven't saved any packages yet.
      </p>
      <div>
        <%= link_to "✚ Track New Package", new_package_path,
              class: "self-start bg-blue-600 text-white px-3 py-2 rounded hover:bg-blue-700 text-sm sm:text-base" %>
      </div>
    </div>
  <% end %>
</div>

