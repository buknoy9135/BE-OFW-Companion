<div class="mb-4">
  <%= link_to "Back to Packages", packages_path, class: "text-blue-600 hover:underline" %>
</div>

<h1 class="text-2xl font-bold mb-4">Package Details</h1>

<div class="p-6 border rounded-lg bg-white shadow">
  <p><strong>Tracking Number:</strong> <%= @package.tracking_number %></p>
  <p><strong>Courier:</strong> <%= @package.courier_name %></p>
  <p><strong>Status:</strong> <%= @package.status.presence || "N/A" %></p>
  <p><strong>Last Location:</strong> <%= @package.last_location.presence || "Unknown" %></p>
  <p><strong>Last Update:</strong> <%= @package.last_update ? @package.last_update.strftime("%b %d, %Y %I:%M %p") : "N/A" %></p>
  <p><strong>Expected Delivery:</strong> <%= @package.expected_delivery ? @package.expected_delivery.strftime("%b %d, %Y") : "N/A" %></p>
</div>

<!-- Modal always visible on show page -->
<div class="mt-6 border rounded-lg bg-white shadow">
  <!-- Tabs -->
  <div class="flex border-b">
    <button onclick="showTab('info')" id="infoTabBtn" class="px-4 py-2 border-b-2 border-blue-600 text-blue-600">Info Details</button>
    <button onclick="showTab('events')" id="eventsTabBtn" class="px-4 py-2 text-gray-500">Event History</button>
  </div>

  <!-- Tab Contents -->
  <div id="infoTab" class="p-4">
    <p><strong>Tracking Number:</strong> <%= @package.tracking_number %></p>
    <p><strong>Courier:</strong> <%= @package.courier_name %></p>
    <p><strong>Status:</strong> <%= @package.status.presence || "N/A" %></p>
    <p><strong>Last Location:</strong> <%= @package.last_location.presence || "Unknown" %></p>
    <p><strong>Last Update:</strong> <%= @package.last_update ? @package.last_update.strftime("%b %d, %Y %I:%M %p") : "N/A" %></p>
    <p><strong>Expected Delivery:</strong> <%= @package.expected_delivery ? @package.expected_delivery.strftime("%b %d, %Y") : "N/A" %></p>
    <p><strong>Latest Description:</strong> <%= @package.latest_description.presence || "N/A" %></p>
    <p><strong>Latest Stage:</strong> <%= @package.latest_stage.presence || "N/A" %></p>
    <p><strong>Latest Substatus:</strong> <%= @package.latest_substatus.presence || "N/A" %></p>
    <p><strong>Tracking Provider:</strong> <%= @package.tracking_provider.presence || "N/A" %></p>
  </div>

  <div id="eventsTab" class="p-4 hidden">
    <% events = @package.tracking_events.is_a?(Array) ? @package.tracking_events : [] %>
    <% if events.any? %>
      <ul class="space-y-2">
        <% events.each do |event| %>
          <li class="p-2 border rounded">
            <p><strong>Stage:</strong> <%= event["stage"].presence || "N/A" %></p>
            <p><strong>Description:</strong> <%= event["description"].presence || "N/A" %></p>
            <p><strong>Location:</strong> <%= event.dig("address", "city") || event["location"] || "Unknown" %></p>
            <p><strong>Time:</strong> <%= event["time_utc"] ? Time.zone.parse(event["time_utc"]).strftime("%b %d, %Y %I:%M %p") : "N/A" %></p>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p>No events available.</p>
    <% end %>
  </div>
</div>

<script>
  function showTab(tab) {
    const infoTab = document.getElementById('infoTab');
    const eventsTab = document.getElementById('eventsTab');
    const infoBtn = document.getElementById('infoTabBtn');
    const eventsBtn = document.getElementById('eventsTabBtn');

    if(tab === 'info') {
      infoTab.classList.remove('hidden');
      eventsTab.classList.add('hidden');
      infoBtn.classList.add('border-b-2','border-blue-600','text-blue-600');
      infoBtn.classList.remove('text-gray-500');
      eventsBtn.classList.remove('border-b-2','border-blue-600','text-blue-600');
      eventsBtn.classList.add('text-gray-500');
    } else {
      infoTab.classList.add('hidden');
      eventsTab.classList.remove('hidden');
      eventsBtn.classList.add('border-b-2','border-blue-600','text-blue-600');
      eventsBtn.classList.remove('text-gray-500');
      infoBtn.classList.remove('border-b-2','border-blue-600','text-blue-600');
      infoBtn.classList.add('text-gray-500');
    }
  }
</script>
