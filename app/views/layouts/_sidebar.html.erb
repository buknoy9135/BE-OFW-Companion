<!-- Desktop/Laptop Sidebar (hidden on tablet/mobile) -->
<aside class="hidden lg:flex bg-[#fafafa] w-64 px-6 py-4 flex-col items-stretch gap-6 h-screen fixed border-r border-gray-200">
  
 <!-- Logo -->
<div class="flex items-center justify-between w-full">
  <div class="flex items-center gap-3">
    <!-- Logo box -->
    <div class="w-10 h-10 rounded-lg bg-gray-200 hover:bg-blue-600 flex items-center justify-center">
      <%= image_tag "ofw-companion-logo.svg", alt: "ofw-logo", class: "w-8 h-8" %>
    </div>

    <!-- Text -->
    <div class="flex flex-col leading-tight">
      <span class="text-md font-semibold">OFW Companion</span>
      <span class="text-xs text-gray-600">v1.0.0</span>
    </div>
  </div>
</div>


  <!-- Nav -->
  <nav class="flex flex-col gap-2 w-full flex-1">
    <span class="uppercase text-xs font-medium text-zinc-500 mt-4 tracking-wide">User</span>

    <a href="<%= dashboard_index_path %>"
        class="flex items-center gap-3 py-2.5 px-3 rounded-lg text-sm font-medium hover:bg-gray-300 text-[#222222] <%= 'bg-gray-300 font-semibold' if current_page?(dashboard_index_path) %>">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-layout-dashboard-icon lucide-layout-dashboard">
        <rect width="7" height="9" x="3" y="3" rx="1"/>
        <rect width="7" height="5" x="14" y="3" rx="1"/>
        <rect width="7" height="9" x="14" y="12" rx="1"/>
        <rect width="7" height="5" x="3" y="16" rx="1"/>
      </svg>
      Dashboard
    </a>

    <a href="<%= currency_converter_path %>"
        class="flex items-center gap-3 py-2.5 px-3 rounded-lg text-sm font-medium hover:bg-gray-300 text-[#222222] <%= 'bg-gray-300 font-semibold' if current_page?(currency_converter_path) %>">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-badge-dollar-sign-icon lucide-badge-dollar-sign">
        <path d="M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z"/>
        <path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"/>
        <path d="M12 18V6"/>
      </svg>
      Currency Exchange
    </a>

    <a href="<%= packages_path %>"
        class="flex items-center gap-3 py-2.5 px-3 rounded-lg text-sm font-medium hover:bg-gray-300 text-[#222222] <%= 'bg-gray-300 font-semibold' if current_page?(packages_path) %>">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-package-icon lucide-package">
        <path d="M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z"/>
        <path d="M12 22V12"/>
        <polyline points="3.29 7 12 12 20.71 7"/>
        <path d="m7.5 4.27 9 5.15"/>
      </svg>
      Package Tracker
    </a>

    <a href="<%= remittance_centers_path %>"
        class="flex items-center gap-3 py-2.5 px-3 rounded-lg text-sm font-medium hover:bg-gray-300 text-[#222222] <%= 'bg-gray-300 font-semibold' if current_page?(remittance_centers_path) %>">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-map-pin-icon lucide-map-pin">
        <path d="M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"/>
        <circle cx="12" cy="10" r="3"/>
      </svg>
      Remit Near Me
    </a>
  </nav>

  <!-- BOTTOM SECTION -->
  <div id="user-info" class="flex justify-between gap-3 mt-auto">
    <div class="flex justify-center items-center gap-2">
      <div class="rounded-lg h-8 w-8 bg-gray-200 flex justify-center items-center hover:bg-blue-700">
        <svg class="w-5 h-5 text-gray-800" xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
          <path d="M18 20a6 6 0 0 0-12 0" />
          <circle cx="12" cy="10" r="4" />
          <circle cx="12" cy="12" r="10" />
        </svg>
      </div>
      <div class="grid flex-1 text-left text-sm leading-tight">
        <span class="truncate font-medium">
           <%= current_user.full_name %>
        </span>
        <span class="truncate text-xs"><%= current_user.email %></span>
      </div>
    </div>

    <div class="cursor-pointer">
      <%= link_to destroy_user_session_path,
            data: { turbo_method: :delete, turbo_confirm: "Are you sure?" },
            class: "flex items-center gap-2 p-2 hover:bg-gray-200 rounded hover:cursor-pointer" do %>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
              viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round"
              class="lucide lucide-log-out-icon lucide-log-out">
          <path d="m16 17 5-5-5-5" />
          <path d="M21 12H9" />
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
        </svg>
      <% end %>
    </div>
  </div>
</aside>

<!-- Tablet/Mobile Navbar (visible on tablet/mobile) -->
<nav class="lg:hidden bg-[#fafafa] w-full px-4 py-3 flex items-center justify-between border-b border-gray-200 relative">
  
  <!-- Logo (clickable, goes to dashboard) -->
  <a href="#" class="flex items-center">
    <%= image_tag "ofw-companion-logo.svg", alt: "ofw-logo", class: "w-[3rem] h-[3rem]" %>
  </a>

  <!-- Burger Menu Button -->
  <button id="mobile-menu-button" class="p-2 hover:bg-gray-200 rounded-lg transition-colors">
    <svg id="hamburger-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
          viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
      <line x1="4" x2="20" y1="6" y2="6"/>
      <line x1="4" x2="20" y1="12" y2="12"/>
      <line x1="4" x2="20" y1="18" y2="18"/>
    </svg>
    <svg id="close-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
          viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round" class="hidden">
      <path d="m18 6-12 12"/>
      <path d="m6 6 12 12"/>
    </svg>
  </button>

  <!-- Mobile Dropdown Menu -->
  <div id="mobile-menu" class="hidden absolute top-full left-0 right-0 bg-[#fafafa] border-b border-gray-200 shadow-lg z-50">
    <div class="px-4 py-3">
      <span class="uppercase text-xs font-medium text-zinc-500 tracking-wide block mb-3">User</span>

      <a href="<%= dashboard_index_path %>" class="block py-3 px-3 rounded-lg text-sm font-medium hover:bg-gray-200 text-[#222222] <%= 'bg-gray-200 font-semibold' if current_page?(dashboard_index_path) %> mb-2">
        Dashboard
      </a>

      <a href="<%= currency_converter_path %>" class="block py-3 px-3 rounded-lg text-sm font-medium hover:bg-gray-200 text-[#222222] <%= 'bg-gray-200 font-semibold' if current_page?(currency_converter_path) %> mb-2">
        Currency Exchange
      </a>

      <a href="<%= packages_path %>" class="block py-3 px-3 rounded-lg text-sm font-medium hover:bg-gray-200 text-[#222222] <%= 'bg-gray-200 font-semibold' if current_page?(packages_path) %> mb-2">
        Package Tracker
      </a>

      <a href="<%= remittance_centers_path %>" class="block py-3 px-3 rounded-lg text-sm font-medium hover:bg-gray-200 text-[#222222] <%= 'bg-gray-200 font-semibold' if current_page?(remittance_centers_path) %> mb-4">
        Remit Near Me
      </a>

      <!-- User Info in Mobile Menu -->
      <div class="border-t border-gray-200 pt-3 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="rounded-lg h-8 w-8 bg-gray-200 flex justify-center items-center hover:bg-blue-600">
            <svg class="w-5 h-5 text-gray-800" xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                  stroke-linecap="round" stroke-linejoin="round">
              <path d="M18 20a6 6 0 0 0-12 0" />
              <circle cx="12" cy="10" r="4" />
              <circle cx="12" cy="12" r="10" />
            </svg>
          </div>
          <div class="text-xs text-gray-600">
            <div class="font-medium"><%= current_user.full_name %></div>
            <div><%= @current_user.email %></div>
          </div>
        </div>
        <%= link_to destroy_user_session_path,
              data: { turbo_method: :delete, turbo_confirm: "Are you sure?" },
              class: "p-2 hover:bg-gray-200 rounded transition-colors" do %>
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
            <path d="m16 17 5-5-5-5" />
            <path d="M21 12H9" />
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
          </svg>
        <% end %>
      </div>
    </div>
  </div>
</nav>

<script defer>
  document.addEventListener('turbo:load', function() {
    initializeMobileMenu();
  });

  document.addEventListener('DOMContentLoaded', function() {
    initializeMobileMenu();
  });

  let clickOutsideListener = null;

  function initializeMobileMenu() {
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const hamburgerIcon = document.getElementById('hamburger-icon');
    const closeIcon = document.getElementById('close-icon');

    if (!mobileMenuButton || !mobileMenu || !hamburgerIcon || !closeIcon) return;

    if (clickOutsideListener) {
      document.removeEventListener('click', clickOutsideListener);
    }

    const newButton = mobileMenuButton.cloneNode(true);
    mobileMenuButton.parentNode.replaceChild(newButton, mobileMenuButton);

    newButton.addEventListener('click', function() {
      const isMenuOpen = !mobileMenu.classList.contains('hidden');

      if (isMenuOpen) {
        mobileMenu.classList.add('hidden');
        hamburgerIcon.classList.remove('hidden');
        closeIcon.classList.add('hidden');
      } else {
        mobileMenu.classList.remove('hidden');
        hamburgerIcon.classList.add('hidden');
        closeIcon.classList.remove('hidden');
      }
    });

    clickOutsideListener = function(event) {
      const isClickInsideMenu = mobileMenu.contains(event.target);
      const isClickOnButton = newButton.contains(event.target);

      if (!isClickInsideMenu && !isClickOnButton && !mobileMenu.classList.contains('hidden')) {
        mobileMenu.classList.add('hidden');
        hamburgerIcon.classList.remove('hidden');
        closeIcon.classList.add('hidden');
      }
    };

    document.addEventListener('click', clickOutsideListener);
  }
</script>